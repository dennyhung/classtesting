<!DOCTYPE html>
<html>
<head>
<title>Message Board</title>
<script src="https://www.gstatic.com/firebasejs/5.8.0/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyB0RImfuC34eiBRFlJCCQgNGC0I51VF9Us",
    authDomain: "asdasd-e70b3.firebaseapp.com",
    databaseURL: "https://asdasd-e70b3.firebaseio.com",
    projectId: "asdasd-e70b3",
    storageBucket: "asdasd-e70b3.appspot.com",
    messagingSenderId: "1015219666941"
  };
  firebase.initializeApp(config);
  let auth=firebase.auth();
  let provider=new firebase.auth.FacebookAuthProvider();
  provider.addScope('user_birthday');
  //當使用者登入狀態變化的時候，呼叫我們提供的函式
  let currentUser=null;
  auth.onAuthStateChanged(function(user) {
	  let member=document.querySelector("#member");
	  let welcome=document.querySelector("#welcome");
	  member.style.disply="none";
	  welcome.style.display="none";
  if(user){
    // 使用者已經登入
    console.log(user);
	  currentUser=null;
	  member.style.display="block";
  }else{ //使用者已經登出
	  console.log(user);
	  currentUser=null;
	  welcome.style.display="block";
  }
});
function signIn(){
	auth.signInWithPopup(provider).then(function(result){
	}).catch(function(error){
		console.log(error);
	});
}
let db=firebase.database();
function post(){
	let id=currentUser.uid;
	let name=currentUser.displayName;
	let content=document.querySelector("#conntent");
	//加入資料庫
	let ref=db.ref("/messages");
	ref.push({
		id:id,name:name,content:content,time:Date.now()
	},function(error){
		if(error){
			alert(error);
		}else{
			alert("OK");
		}
	})
}
</script>
</script>
</head>
<body>
	<h3>Message Board</h3>
	<div id="welcome" style="display:none;">
	<button onclick="signIn();">Sign In</button>
	</div>
	<div id="member" style="display:none;">
		<textarea id="content"></textarea>
		<button onclick="post();">Post</button>
	</div>
	<div id="list">Message List</div>
</body>
</html>
